#!/usr/bin/env bash
#!/bin/bash

rm -rf build
mkdir build
cp -r app/ bootstrap/ config/ routes/ storage/ composer.json build/
cp bin/ductn build/artisan
composer config -d build/ platform.php 8.1
composer install -d build/ --no-dev

cd build/vendor
rm -rf */*/tests/ */*/src/tests/ */*/docs/ */*/*.md */*/composer.* */*/phpunit.* */*/.gitignore */*/.*.yml */*/*.xml
cd - >/dev/null

cd build/vendor/symfony/
rm -rf */Symfony/Component/*/Tests/ */Symfony/Component/*/*.md */Symfony/Component/*/composer.* */Symfony/Component/*/phpunit.* */Symfony/Component/*/.gitignore
cd - >/dev/null

# chmod +x bin/phar-composer
# bin/phar-composer build build/ ductn-cli
php -d phar.readonly=off bin/phar-composer build build/ ductn
chmod +x ductn
# rm -rf build
