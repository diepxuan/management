#!/usr/bin/env bash

_BASEDIR="/var/www/base"
_BASHDIR="$_BASEDIR/bash"

service() {
    # Web Server
    if [[ ! "$(sudo /usr/sbin/service apache2 status)" =~ "start/running" ]]; then
        sudo /usr/sbin/service apache2 start
    fi
    if [[ ! "$(sudo /usr/sbin/service mysql status)" =~ "start/running" ]]; then
        $_BASHDIR/ductn --swap
        sudo /usr/sbin/service mysql start
    fi
    exit 0
}

update() {

    getip() {
        host $@ | cut -f4 -d' '
    }

    allowdomain() {
        if [ "$(whoami)" = "ductn" ]; then
            # sudo ufw allow proto tcp from "$(getip $@)" to any port 1433
            sudo ufw allow proto tcp from "$(getip $@)"
        fi
    }

    updateallowip() {
        allowdomain dxvnkthd.ddns.net
        allowdomain dxvnk113.ddns.net
        allowdomain dxvnkkcn.ddns.net
        allowdomain mg15vincom.ddns.net
    }

    $@

    exit 0

}

$@

chmod u+x $_BASHDIR/cronjob/*.sh
chmod u+x $_BASHDIR/cronjob/cronjob
crontab $_BASHDIR/cronjob/cronjob.conf

sudo service cron restart
